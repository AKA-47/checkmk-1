#!/bin/bash
set -e

SITE=${SITE:-$(cat ../../../.site 2>/dev/null || true)}
SITE=${SITE:-$(omd sites --bare | head -n 1)}
ROOT=$ROOT

echo "Installing to site \"$SITE\"..."

if [ ! -d net-snmp-5.7.3 ]; then
    make
    cd net-snmp-5.7.3
else
    cd net-snmp-5.7.3
    make || exit 1
fi

cd python
sudo PYTHONPATH=$PYTHONPATH:$ROOT/lib/python \
    python setup.py install --home=$ROOT \
                --prefix='' \
                --install-platlib=$ROOT/lib/python \
                --install-purelib=$ROOT/lib/python

cd ..

sudo install -m 755 apps/.libs/snmp{bulkwalk,walk,get} $ROOT/bin
sudo install -m 644 snmplib/.libs/libnetsnmp.* $ROOT/lib
