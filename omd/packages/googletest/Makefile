include ../../Makefile.omd

# tar file generated by cloning https://github.com/google/googletest and doing:
# ( VERSION=0048647619; git archive --prefix=googletest-$VERSION/ -o ~/git/check_mk/omd/packages/googletest/googletest-$VERSION.tar.gz $VERSION )

NAME    := googletest
VERSION := 0048647619
DIR     := $(NAME)-$(VERSION)

.PHONY: build install skel clean

# The rules below are not perfect, but good enough for now...
build: $(DIR)/Makefile
	$(MAKE) -C $(DIR)
	mkdir -p $(PACKAGE_GOOGLETEST_DESTDIR)/lib
# We do not ship the headers and libraries, we just need them at a known
# location for testing.
	cp -au $(DIR)/googletest/include $(DIR)/googlemock/include $(PACKAGE_GOOGLETEST_DESTDIR)
	cp -au $(DIR)/googletest/lib/.libs/lib*.a $(DIR)/googlemock/lib/.libs/lib*.a $(PACKAGE_GOOGLETEST_DESTDIR)/lib

$(DIR)/Makefile.in: $(DIR).tar.gz
	tar xzf $(DIR).tar.gz
# The structure of the autotools m4 macro directories within googletest is a bit
# obscure. Furthermore, there seems to be some autotools versionitis in this
# area. Simply creating an empty directory seems to work around warnings/errors
# (depends on autottools version).
	mkdir -p $(DIR)/m4
	cd $(DIR) && autoreconf -i

$(DIR)/Makefile: $(DIR)/Makefile.in
	cd $(DIR) && ./configure --disable-shared

install:

skel:

clean:
	rm -rf $(DIR) $(PACKAGE_GOOGLETEST_DESTDIR)
